    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ë‚˜ì˜ ë™ë¬¼ ìœ í˜• í…ŒìŠ¤íŠ¸</title>
        <style>
            /* ì „ì²´ í˜ì´ì§€ì˜ ê¸°ë³¸ ìŠ¤íƒ€ì¼ì„ ì„¤ì •í•©ë‹ˆë‹¤ */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
                position: relative;
            }

            /* ë©”ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
            .container {
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                max-width: 700px;
                width: 100%;
                padding: 40px;
                animation: fadeIn 0.5s ease-in;
            }

            /* í˜ì´ë“œì¸ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* í—¤ë” ìŠ¤íƒ€ì¼ */
            h1 {
                color: #333;
                text-align: center;
                margin-bottom: 10px;
                font-size: 2em;
            }

            .subtitle {
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 1.1em;
            }

            /* ì‹œì‘ í™”ë©´ ìŠ¤íƒ€ì¼ */
            .start-screen {
                display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ (ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í›„ í‘œì‹œ) */
                text-align: center;
            }

            .animal-intro {
                background: #f8f9fa;
                border-radius: 15px;
                padding: 20px;
                margin: 20px 0;
                text-align: left;
            }

            .animal-intro h3 {
                color: #667eea;
                margin-bottom: 15px;
            }

            .animal-item {
                padding: 10px 0;
                font-size: 1.1em;
                color: #555;
            }

            .animal-item span {
                font-size: 1.5em;
                margin-right: 10px;
            }

            /* ë™ë¬¼ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
            .animal-item img {
                width: 40px;
                height: 40px;
                object-fit: contain;
                margin-right: 10px;
                vertical-align: middle;
            }

            /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
            .btn {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 15px 40px;
                font-size: 1.1em;
                border-radius: 50px;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-top: 20px;
            }

            .btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
            }

            /* í€´ì¦ˆ í™”ë©´ ìŠ¤íƒ€ì¼ */
            .quiz-screen {
                display: none;
            }

            .progress-bar {
                background: #e0e0e0;
                height: 10px;
                border-radius: 10px;
                margin-bottom: 30px;
                overflow: hidden;
            }

            .progress {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                height: 100%;
                width: 0%;
                transition: width 0.3s ease;
            }

            .question-number {
                color: #667eea;
                font-weight: bold;
                margin-bottom: 10px;
                font-size: 0.9em;
            }

            .question {
                font-size: 1.3em;
                color: #333;
                margin-bottom: 30px;
                font-weight: 600;
            }

            /* ë‹µë³€ ì„ íƒì§€ ìŠ¤íƒ€ì¼ */
            .answers {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            .answer-btn {
                background: white;
                border: 2px solid #e0e0e0;
                padding: 20px;
                border-radius: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: left;
                font-size: 1em;
                color: #555;
            }

            .answer-btn:hover {
                border-color: #667eea;
                background: #f8f9ff;
                transform: translateX(5px);
            }

            /* ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ */
            .result-screen {
                display: none;
                text-align: center;
            }

            .result-animal {
                font-size: 5em;
                margin: 20px 0;
                animation: bounce 1s ease infinite;
            }

            /* ê²°ê³¼ í™”ë©´ì˜ ë™ë¬¼ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
            .result-animal img {
                width: 150px;
                height: 150px;
                object-fit: contain;
                display: block;
                margin: 0 auto;
            }

            @keyframes bounce {
                0%, 100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(-10px);
                }
            }

            .result-type {
                font-size: 2em;
                color: #667eea;
                font-weight: bold;
                margin-bottom: 15px;
            }

            .result-description {
                background: #f8f9fa;
                border-radius: 15px;
                padding: 25px;
                margin: 20px 0;
                text-align: left;
            }

            .result-description h3 {
                color: #667eea;
                margin-bottom: 15px;
            }

            .result-description p {
                color: #555;
                line-height: 1.8;
                margin-bottom: 10px;
            }

            .share-text {
                background: #fff3cd;
                border-radius: 10px;
                padding: 15px;
                margin: 20px 0;
                color: #856404;
                font-size: 0.9em;
            }


            /* ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í™”ë©´ ìŠ¤íƒ€ì¼ */
            .user-info-screen {
                display: block; /* ê¸°ë³¸ì ìœ¼ë¡œ í‘œì‹œ (í˜ì´ì§€ ë¡œë“œ ì‹œ ë¨¼ì € ë³´ì—¬ì¤Œ) */
                text-align: center;
            }

            .user-info-form {
                background: #f8f9fa;
                border-radius: 15px;
                padding: 30px;
                margin: 20px 0;
                text-align: left;
            }

            .info-note {
                background: #e8f4f8;
                border-left: 4px solid #667eea;
                padding: 12px 15px;
                margin-bottom: 20px;
                border-radius: 5px;
                font-size: 0.9em;
                color: #555;
            }

            /* í¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: #333;
                font-size: 1em;
            }

            .form-group input {
                width: 100%;
                padding: 12px 15px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                font-size: 1em;
                transition: border-color 0.3s ease;
                box-sizing: border-box;
            }

            .form-group input:focus {
                outline: none;
                border-color: #667eea;
            }

            /* ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
            .error-message {
                color: #dc3545;
                font-size: 0.85em;
                margin-top: 5px;
                display: none;
            }

            /* ë°˜ì‘í˜• ë””ìì¸ */
            @media (max-width: 600px) {
                .container {
                    padding: 25px;
                }

                h1 {
                    font-size: 1.5em;
                }

                .question {
                    font-size: 1.1em;
                }

                .result-animal {
                    font-size: 3.5em;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í™”ë©´ -->
            <div class="user-info-screen" id="userInfoScreen">
                <h1>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”!</h1>
                <p class="subtitle">í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                
                <div class="user-info-form">
                    <div class="info-note">
                        ğŸ’¡ ì†Œì†, ì´ë¦„, ì´ë©”ì¼ì€ í†µê³„ ë¶„ì„ì—ë§Œ ì‚¬ìš©ë˜ë©°, ê°œì¸ì •ë³´ëŠ” ì•ˆì „í•˜ê²Œ ê´€ë¦¬ë©ë‹ˆë‹¤.
                    </div>
                    
                    <div class="form-group">
                        <label for="userSchool">ì†Œì† ê¸°ê´€</label>
                        <input type="text" id="userSchool" placeholder="ì˜ˆ: ì„œìš¸ì´ˆë“±í•™êµ" autocomplete="organization">
                        <div class="error-message" id="schoolError"></div>
                        <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                            ê¸°ê´€ì˜ ê³µì‹ ëª…ì¹­ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: OOì´ˆë“±í•™êµ, OOì¤‘í•™êµ ë“±)
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="userName">ì´ë¦„</label>
                        <input type="text" id="userName" placeholder="ì˜ˆ: í™ê¸¸ë™" autocomplete="name">
                        <div class="error-message" id="nameError"></div>
                        <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                            ì„±ê³¼ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="userEmail">ì´ë©”ì¼</label>
                        <input type="email" id="userEmail" placeholder="ì˜ˆ: hong@example.com" autocomplete="email">
                        <div class="error-message" id="emailError"></div>
                        <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                            ê²°ê³¼ í™•ì¸ ë° í†µê³„ ë¶„ì„ì— ì‚¬ìš©ë©ë‹ˆë‹¤
                        </small>
                    </div>
                    
                    <div class="error-message" id="userInfoError" style="text-align: center; margin-top: 10px;"></div>
                    
                    <button class="btn" onclick="saveUserInfo()" style="width: 100%; margin-top: 10px;">ë‹¤ìŒ</button>
                </div>
            </div>

            <!-- ì‹œì‘ í™”ë©´ -->
            <div class="start-screen" id="startScreen">
                <h1>ğŸ¯ ë‚˜ì˜ ë™ë¬¼ ìœ í˜• í…ŒìŠ¤íŠ¸</h1>
                <p class="subtitle">ë‚˜ëŠ” ì–´ë–¤ ë™ë¬¼ ìœ í˜•ì¼ê¹Œ?</p>
                
                <div class="animal-intro">
                    <h3>ğŸŒŸ 5ê°€ì§€ ë™ë¬¼ ìœ í˜•</h3>
                    <div class="animal-item"><img src="https://hanuipyo.github.io/animal_mbti/ì¼ê°œë¯¸.png" alt="ì¼ê°œë¯¸"> <strong>ì¼ê°œë¯¸í˜•</strong> - ì ì‹œë„ ì‰¬ì§€ ëª»í•˜ëŠ”</div>
                    <div class="animal-item"><img src="https://hanuipyo.github.io/animal_mbti/ì¹´ë©œë ˆì˜¨.png" alt="ì¹´ë©œë ˆì˜¨"> <strong>ì¹´ë©œë ˆì˜¨í˜•</strong> - ë§¤ì¼ ë‹¤ë¥¸ ê¿ˆì„ ê¾¸ëŠ”</div>
                    <div class="animal-item"><img src="https://hanuipyo.github.io/animal_mbti/ë¶€ì—‰ì´.png" alt="ë¶€ì—‰ì´"> <strong>ë¶€ì—‰ì´í˜•</strong> - í•­ìƒ ê³°ê³°íˆ ê³ ë¯¼í•´ë³´ëŠ”</div>
                    <div class="animal-item"><img src="https://hanuipyo.github.io/animal_mbti/í™©ì œí­ê·„.png" alt="í™©ì œí­ê·„"> <strong>í™©ì œí­ê·„í˜•</strong> - í˜¼ìì„  ëª»ì‚¬ëŠ”</div>
                    <div class="animal-item"><img src="https://hanuipyo.github.io/animal_mbti/ì•µë¬´ìƒˆ.png" alt="ì•µë¬´ìƒˆ"> <strong>ì•µë¬´ìƒˆí˜•</strong> - í•­ìƒ ì•Œë ¤ì£¼ê³  ì‹¶ì€</div>
                </div>

                <button class="btn" onclick="startQuiz()">í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°</button>
            </div>

            <!-- í€´ì¦ˆ í™”ë©´ -->
            <div class="quiz-screen" id="quizScreen">
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="question-number" id="questionNumber">ì§ˆë¬¸ 1 / 10</div>
                <div class="question" id="question"></div>
                <div class="answers" id="answers"></div>
            </div>

            <!-- ê²°ê³¼ í™”ë©´ -->
            <div class="result-screen" id="resultScreen">
                <h1>ë‹¹ì‹ ì˜ ë™ë¬¼ ìœ í˜•ì€?</h1>
                <div class="result-animal" id="resultAnimal"></div>
                <div class="result-type" id="resultType"></div>
                <div class="result-description" id="resultDescription"></div>
                <div class="share-text">
                    ğŸ’¡ ì´ ê²°ê³¼ë¥¼ ì¹œêµ¬ë“¤ê³¼ ê³µìœ í•´ë³´ì„¸ìš”!
                </div>
                <button class="btn" onclick="restartQuiz()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°</button>
            </div>
        </div>

        <script>
            // ê° ë™ë¬¼ ìœ í˜•ì˜ ì ìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” ê°ì²´
            // ant: ì¼ê°œë¯¸, chameleon: ì¹´ë©œë ˆì˜¨, owl: ë¶€ì—‰ì´, penguin: í™©ì œí­ê·„, parrot: ì•µë¬´ìƒˆ
            let scores = {
                ant: 0,         // ì¼ê°œë¯¸ ì ìˆ˜
                chameleon: 0,   // ì¹´ë©œë ˆì˜¨ ì ìˆ˜
                owl: 0,         // ë¶€ì—‰ì´ ì ìˆ˜
                penguin: 0,     // í™©ì œí­ê·„ ì ìˆ˜
                parrot: 0       // ì•µë¬´ìƒˆ ì ìˆ˜
            };

            let currentQuestion = 0; // í˜„ì¬ ì§ˆë¬¸ ë²ˆí˜¸ (0ë¶€í„° ì‹œì‘)

            const MAX_PARTICIPANTS = 120; // ìµœëŒ€ ì°¸ì—¬ ì¸ì›ìˆ˜

            // Google Apps Script ì›¹ ì•± URL
            // âš ï¸ ì¤‘ìš”: SETUP_GUIDE.mdë¥¼ ì°¸ê³ í•˜ì—¬ Google Apps Scriptë¥¼ ë°°í¬í•œ í›„ ì—¬ê¸°ì— URLì„ ì…ë ¥í•˜ì„¸ìš”
            // ë°°í¬ í›„ ë°›ì€ ì›¹ ì•± URLì„ ì•„ë˜ì— ì…ë ¥í•˜ì„¸ìš”
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwnz50UoAHG9eIMt2Rqie5UUGTkyFVsL0roE5fKE6roMknGNaXiaw_T26HsMCDIq4Q/exec';
            // ì˜ˆ: 'https://script.google.com/macros/s/AKfycby.../exec'
            
            // ë³´ì•ˆ í† í° (Google Apps Scriptì˜ SECRET_TOKENê³¼ ë™ì¼í•œ ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤)
            // âš ï¸ ì¤‘ìš”: google-apps-script.gsì˜ SECRET_TOKENê³¼ ë™ì¼í•œ ê°’ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”
            const API_TOKEN = 'growthtogetherexperience';

            // í†µê³„ ë°ì´í„° ìºì‹œ (ë¡œë”© ì„±ëŠ¥ í–¥ìƒ)
            let cachedStats = null;
            let statsLoading = false;

            // ì‚¬ìš©ì ì •ë³´ ì €ì¥
            let userInfo = {
                school: '',
                name: '',
                email: ''
            };

        // ë™ë¬¼ ìœ í˜• ì˜ë¬¸ â†’ í•œê¸€ ë³€í™˜ ë§¤í•‘
        const animalTypeNames = {
            ant: 'ì¼ê°œë¯¸',
            chameleon: 'ì¹´ë©œë ˆì˜¨',
            owl: 'ë¶€ì—‰ì´',
            penguin: 'í™©ì œí­ê·„',
            parrot: 'ì•µë¬´ìƒˆ'
        };

        // ì„±í–¥ì´ ë¹„ìŠ·í•œ ë™ë¬¼ ìœ í˜• ë§¤í•‘ (ê· ë“± ë°°ì • ì‹œ ì‚¬ìš©)
        // ê° ìœ í˜•ì´ ë¶€ì¡±í•  ë•Œ ëŒ€ì²´í•  ìˆ˜ ìˆëŠ” ìœ í˜•ë“¤
        const similarTypes = {
            ant: ['owl'],           // ì¼ê°œë¯¸ â†” ë¶€ì—‰ì´ (ë‘˜ ë‹¤ ì‹ ì¤‘í•˜ê³  ê³„íšì )
            chameleon: ['parrot'],  // ì¹´ë©œë ˆì˜¨ â†” ì•µë¬´ìƒˆ (ë‘˜ ë‹¤ ë‹¤ì–‘ì„±ê³¼ ì†Œí†µ)
            owl: ['ant'],           // ë¶€ì—‰ì´ â†” ì¼ê°œë¯¸ (ë‘˜ ë‹¤ ì‹ ì¤‘í•¨)
            penguin: ['parrot'],    // í™©ì œí­ê·„ â†” ì•µë¬´ìƒˆ (ë‘˜ ë‹¤ ì†Œí†µê³¼ ê³µìœ  ì¤‘ì‹œ)
            parrot: ['chameleon', 'penguin'] // ì•µë¬´ìƒˆ â†” ì¹´ë©œë ˆì˜¨, í™©ì œí­ê·„ (ì†Œí†µê³¼ ë‹¤ì–‘ì„±)
        };

            // Google Sheetsì—ì„œ í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ (ë¹„ë™ê¸°)
            async function loadStatistics() {
                // ìºì‹œëœ ë°ì´í„°ê°€ ìˆê³  ìµœê·¼ì— ë¡œë“œí–ˆë‹¤ë©´ ìºì‹œ ì‚¬ìš©
                if (cachedStats && !statsLoading) {
                    return cachedStats;
                }

                // URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ê¸°ë³¸ê°’ ë°˜í™˜
                if (!SCRIPT_URL || SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    console.warn('Google Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. SETUP_GUIDE.mdë¥¼ ì°¸ê³ í•˜ì„¸ìš”.');
                    return {
                        ant: 0,
                        chameleon: 0,
                        owl: 0,
                        penguin: 0,
                        parrot: 0,
                        total: 0
                    };
                }

                try {
                    statsLoading = true;
                    const response = await fetch(`${SCRIPT_URL}?action=getStats`);
                    
                    // Google Apps ScriptëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì²˜ë¦¬
                    let finalResponse = response;
                    if (response.redirected) {
                        finalResponse = await fetch(response.url);
                    }
                    
                    const data = await finalResponse.json();
                    
                    if (data.success && data.stats) {
                        cachedStats = data.stats;
                        return data.stats;
                    } else {
                        throw new Error(data.error || 'í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('í†µê³„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    console.error('ì—ëŸ¬ ìƒì„¸:', error.message);
                    // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜
                    return {
                        ant: 0,
                        chameleon: 0,
                        owl: 0,
                        penguin: 0,
                        parrot: 0,
                        total: 0
                    };
                } finally {
                    statsLoading = false;
                }
            }

            // Google Sheetsì— ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜ (ë¹„ë™ê¸°)
            async function saveResultToSheets(animalType, originalType) {
                // URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì €ì¥í•˜ì§€ ì•ŠìŒ
                if (!SCRIPT_URL || SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    console.warn('Google Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ ê²°ê³¼ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return null;
                }

                // ì‚¬ìš©ì ì •ë³´ í™•ì¸
                if (!userInfo.school || !userInfo.name) {
                    console.warn('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ì–´ ê²°ê³¼ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', userInfo);
                    // ì‚¬ìš©ì ì •ë³´ê°€ ì—†ì–´ë„ ì €ì¥ì€ ì‹œë„í•˜ë˜, ë¹ˆ ê°’ìœ¼ë¡œ ì „ì†¡
                }

                try {
                    // User Agent ì •ë³´ ìˆ˜ì§‘
                    const userAgent = navigator.userAgent;
                    
                    // Google Apps Scriptì— POST ìš”ì²­ (FormData ì‚¬ìš©)
                    const formData = new FormData();
                    formData.append('action', 'saveResult');
                    formData.append('token', API_TOKEN); // ë³´ì•ˆ í† í° ì¶”ê°€
                    // ë™ë¬¼ ìœ í˜•ì„ í•œê¸€ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥
                    formData.append('animalType', animalTypeNames[animalType] || animalType);
                    formData.append('originalType', animalTypeNames[originalType] || originalType || animalTypeNames[animalType] || animalType);
                    formData.append('userAgent', userAgent);
                    formData.append('school', userInfo.school || ''); // ì†Œì† ì •ë³´
                    formData.append('name', userInfo.name || ''); // ì´ë¦„ ì •ë³´
                    formData.append('email', userInfo.email || ''); // ì´ë©”ì¼ ì •ë³´
                    
                    // ë””ë²„ê¹…: ì „ì†¡í•  ë°ì´í„° í™•ì¸
                    console.log('ì €ì¥í•  ì‚¬ìš©ì ì •ë³´:', {
                        school: userInfo.school || '(ì—†ìŒ)',
                        name: userInfo.name || '(ì—†ìŒ)',
                        email: userInfo.email || '(ì—†ìŒ)',
                        animalType: animalType
                    });

                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        body: formData
                    });

                    // Google Apps ScriptëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë‹¤ì‹œ fetch
                    let finalResponse = response;
                    if (response.redirected || response.status === 200) {
                        try {
                            finalResponse = await fetch(response.url);
                        } catch (e) {
                            // ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ì—†ìœ¼ë©´ ì›ë³¸ ì‘ë‹µ ì‚¬ìš©
                            finalResponse = response;
                        }
                    }
                    
                    const data = await finalResponse.json();
                    
                    if (data.success) {
                        // ìºì‹œ ì—…ë°ì´íŠ¸
                        if (data.stats) {
                            cachedStats = data.stats;
                        }
                        return data.stats;
                    } else {
                        throw new Error(data.error || 'ê²°ê³¼ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('ê²°ê³¼ ì €ì¥ ì‹¤íŒ¨:', error);
                    return null;
                }
            }

            // Enter í‚¤ë¡œ ì‚¬ìš©ì ì •ë³´ ì…ë ¥ ê°€ëŠ¥í•˜ë„ë¡ ì²˜ë¦¬
            document.addEventListener('DOMContentLoaded', function() {
                // ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í™”ë©´
                const schoolInput = document.getElementById('userSchool');
                const nameInput = document.getElementById('userName');
                const emailInput = document.getElementById('userEmail');
                
                if (schoolInput && nameInput && emailInput) {
                    schoolInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            nameInput.focus();
                        }
                    });
                    
                    nameInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            emailInput.focus();
                        }
                    });
                    
                    emailInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            saveUserInfo();
                        }
                    });
                }
            });


            // ê· ë“± ë°°ì • ë¡œì§: ê°€ì¥ ë§ì€ ìœ í˜•ê³¼ ê°€ì¥ ì ì€ ìœ í˜•ì˜ ì°¨ì´ê°€ 3ëª… ì´ìƒì´ë©´ ì¡°ì • (ë¹„ë™ê¸°)
            async function adjustForBalance(originalType) {
                const stats = await loadStatistics();
                const total = stats.total || (stats.ant + stats.chameleon + stats.owl + stats.penguin + stats.parrot);
                
                // ìµœëŒ€ ì¸ì›ìˆ˜ì— ë„ë‹¬í–ˆìœ¼ë©´ ë” ì´ìƒ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
                if (total >= MAX_PARTICIPANTS) {
                    return originalType;
                }

                // ê° ìœ í˜•ì˜ ì¸ì›ìˆ˜ë¥¼ ë°°ì—´ë¡œ ë³€í™˜
                const typeArray = [
                    { type: 'ant', count: stats.ant || 0 },
                    { type: 'chameleon', count: stats.chameleon || 0 },
                    { type: 'owl', count: stats.owl || 0 },
                    { type: 'penguin', count: stats.penguin || 0 },
                    { type: 'parrot', count: stats.parrot || 0 }
                ];

                // ì¸ì›ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬
                typeArray.sort((a, b) => a.count - b.count);
                
                const maxType = typeArray[typeArray.length - 1]; // ê°€ì¥ ë§ì€ ìœ í˜•
                const minType = typeArray[0]; // ê°€ì¥ ì ì€ ìœ í˜•
                
                // ì°¨ì´ê°€ 3ëª… ì´ìƒì¸ì§€ í™•ì¸
                if (maxType.count - minType.count >= 3) {
                    // ì›ë˜ ìœ í˜•ì´ ê°€ì¥ ë§ì€ ìœ í˜•ì´ë©´, ê°€ì¥ ì ì€ ìœ í˜• ì¤‘ì—ì„œ ì„±í–¥ì´ ë¹„ìŠ·í•œ ê²ƒìœ¼ë¡œ ë³€ê²½
                    if (originalType === maxType.type) {
                        // ê°€ì¥ ì ì€ ìœ í˜•ë“¤ ì¤‘ì—ì„œ ì„±í–¥ì´ ë¹„ìŠ·í•œ ìœ í˜• ì°¾ê¸°
                        const minTypes = typeArray.filter(t => t.count === minType.count);
                        
                        for (let minT of minTypes) {
                            // ì›ë˜ ìœ í˜•ê³¼ ì„±í–¥ì´ ë¹„ìŠ·í•œ ìœ í˜•ì¸ì§€ í™•ì¸
                            if (similarTypes[originalType] && similarTypes[originalType].includes(minT.type)) {
                                return minT.type; // ì„±í–¥ì´ ë¹„ìŠ·í•œ ì ì€ ìœ í˜•ìœ¼ë¡œ ë³€ê²½
                            }
                        }
                        
                        // ì„±í–¥ì´ ë¹„ìŠ·í•œ ìœ í˜•ì´ ì—†ìœ¼ë©´ ê°€ì¥ ì ì€ ìœ í˜•ìœ¼ë¡œ ë³€ê²½
                        return minType.type;
                    }
                }
                
                // ì°¨ì´ê°€ 3ëª… ë¯¸ë§Œì´ê±°ë‚˜ ì›ë˜ ìœ í˜•ì´ ê°€ì¥ ë§ì€ ìœ í˜•ì´ ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
                return originalType;
            }

            // 10ê°€ì§€ ì„¤ë¬¸ ì§ˆë¬¸ê³¼ ê° ë‹µë³€ì˜ ì ìˆ˜ ë°°ë¶„
            const questions = [
                {
                    question: "ì£¼ë§ì— ì¹œêµ¬ë“¤ê³¼ ì•½ì†ì„ ì¡ì„ ë•Œ ë‚˜ëŠ”?",
                    answers: [
                        { text: "ì•½ì† ì¥ì†Œë¶€í„° ë™ì„ ê¹Œì§€ ê¼¼ê¼¼í•˜ê²Œ ê³„íší•˜ê³  ì˜ˆì•½í•œë‹¤", type: "ant" },
                        { text: "ê·¸ë•Œê·¸ë•Œ ë¶„ìœ„ê¸° ë´ì„œ ì¦‰í¥ì ìœ¼ë¡œ ì •í•˜ëŠ” ê²Œ ì¢‹ë‹¤", type: "chameleon" },
                        { text: "ì¥ì†Œì˜ ë¦¬ë·°ë‚˜ ì •ë³´ë¥¼ ë¯¸ë¦¬ ì°¾ì•„ë³´ê³  ì‹ ì¤‘í•˜ê²Œ ê²°ì •í•œë‹¤", type: "owl" },
                        { text: "ëª¨ë‘ì˜ ì˜ê²¬ì„ ë¬¼ì–´ë³´ê³  ë‹¤ ê°™ì´ ê²°ì •í•œë‹¤", type: "penguin" },
                        { text: "ë‚´ê°€ ì•Œê³  ìˆëŠ” ì¢‹ì€ ì¥ì†Œë¥¼ ì¶”ì²œí•˜ê³  ì •ë³´ë¥¼ ê³µìœ í•œë‹¤", type: "parrot" }
                    ]
                },
                {
                    question: "ì—¬í–‰ì„ ê³„íší•  ë•Œ ë‚˜ì˜ ìŠ¤íƒ€ì¼ì€?",
                    answers: [
                        { text: "ì¼ì •í‘œë¥¼ ë§Œë“¤ì–´ ì‹œê°„ëŒ€ë³„ë¡œ ìƒì„¸í•˜ê²Œ ê³„íší•œë‹¤", type: "ant" },
                        { text: "ëŒ€ì¶© ëª©ì ì§€ë§Œ ì •í•˜ê³  í˜„ì§€ì—ì„œ ììœ ë¡­ê²Œ ëŒì•„ë‹¤ë‹Œë‹¤", type: "chameleon" },
                        { text: "ê° ì¥ì†Œì˜ íŠ¹ì§•ì„ ì¡°ì‚¬í•˜ê³  ìµœì ì˜ ë£¨íŠ¸ë¥¼ ì°¾ëŠ”ë‹¤", type: "owl" },
                        { text: "í•¨ê»˜ ê°€ëŠ” ì‚¬ëŒë“¤ê³¼ ì˜ë…¼í•˜ë©° ì¼ì •ì„ ì§ ë‹¤", type: "penguin" },
                        { text: "ì—¬í–‰ ì •ë³´ë¥¼ ì°¾ì•„ì„œ ë™í–‰ìë“¤ì—ê²Œ ê³µìœ í•œë‹¤", type: "parrot" }
                    ]
                },
                {
                    question: "ìƒˆë¡œìš´ ì·¨ë¯¸ë¥¼ ì‹œì‘í•  ë•Œ?",
                    answers: [
                        { text: "ê´€ë ¨ ì±…ì´ë‚˜ ê°•ì˜ë¥¼ ì°¾ì•„ë³´ë©° ì²´ê³„ì ìœ¼ë¡œ ë°°ìš´ë‹¤", type: "ant" },
                        { text: "ì¼ë‹¨ ì¬ë¯¸ìˆì–´ ë³´ì´ë©´ ë°”ë¡œ ì‹œì‘í•´ë³¸ë‹¤", type: "chameleon" },
                        { text: "ì™œ í•˜ê³  ì‹¶ì€ì§€, ë‚˜ì—ê²Œ ë§ëŠ”ì§€ ê¹Šì´ ê³ ë¯¼í•œë‹¤", type: "owl" },
                        { text: "í•¨ê»˜ í•  ì‚¬ëŒì„ ì°¾ê±°ë‚˜ ë™í˜¸íšŒì— ê°€ì…í•œë‹¤", type: "penguin" },
                        { text: "ë°°ìš°ë©´ì„œ ì•Œê²Œ ëœ íŒì„ ì£¼ë³€ì— ì•Œë ¤ì¤€ë‹¤", type: "parrot" }
                    ]
                },
                {
                    question: "ì¹œêµ¬ê°€ ê³ ë¯¼ ìƒë‹´ì„ ìš”ì²­í•˜ë©´?",
                    answers: [
                        { text: "ë°¤ì„ ìƒˆì›Œì„œë¼ë„ ì„±ì‹¬ì„±ì˜ê» ë“¤ì–´ì£¼ê³  ë„ì™€ì¤€ë‹¤", type: "ant" },
                        { text: "ë‹¤ì–‘í•œ ê´€ì ì—ì„œ ìƒˆë¡œìš´ í•´ê²°ì±…ì„ ì œì‹œí•œë‹¤", type: "chameleon" },
                        { text: "ë¬¸ì œì˜ ë³¸ì§ˆì„ íŒŒì•…í•˜ê³  ì‹ ì¤‘í•˜ê²Œ ì¡°ì–¸í•œë‹¤", type: "owl" },
                        { text: "ê³µê°í•˜ë©° ë“¤ì–´ì£¼ê³  í•¨ê»˜ ê³ ë¯¼í•´ì¤€ë‹¤", type: "penguin" },
                        { text: "ë¹„ìŠ·í•œ ê²½í—˜ì´ë‚˜ ì •ë³´ë¥¼ ìì„¸íˆ ê³µìœ í•´ì¤€ë‹¤", type: "parrot" }
                    ]
                },
                {
                    question: "SNSë‚˜ ì˜¨ë¼ì¸ í™œë™ì—ì„œ ë‚˜ëŠ”?",
                    answers: [
                        { text: "ë§¤ì¼ ê¾¸ì¤€íˆ ê¸°ë¡í•˜ê³  ì •ë¦¬í•˜ëŠ” í¸ì´ë‹¤", type: "ant" },
                        { text: "ê´€ì‹¬ì‚¬ê°€ ìì£¼ ë°”ë€Œì–´ì„œ ì˜¬ë¦¬ëŠ” ë‚´ìš©ë„ ë‹¤ì–‘í•˜ë‹¤", type: "chameleon" },
                        { text: "ì˜¬ë¦¬ê¸° ì „ì— ë‚´ìš©ì„ ì—¬ëŸ¬ ë²ˆ ê³ ë¯¼í•˜ê³  ìˆ˜ì •í•œë‹¤", type: "owl" },
                        { text: "ì£¼ë¡œ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ê¸€ì— ëŒ“ê¸€ì„ ë‹¬ë©° ì†Œí†µí•œë‹¤", type: "penguin" },
                        { text: "ìœ ìš©í•œ ì •ë³´ë‚˜ ì•Œê²Œ ëœ ê²ƒì„ ì ê·¹ì ìœ¼ë¡œ ê³µìœ í•œë‹¤", type: "parrot" }
                    ]
                },
                {
                    question: "ì‡¼í•‘ì„ í•  ë•Œ ë‚˜ëŠ”?",
                    answers: [
                        { text: "í•„ìš”í•œ ë¬¼ê±´ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê³  ê¼¼ê¼¼íˆ ë¹„êµí•´ì„œ ì‚°ë‹¤", type: "ant" },
                        { text: "ê·¸ë•Œê·¸ë•Œ ëˆˆì— ë„ëŠ” ê²ƒì„ ì¶©ë™ì ìœ¼ë¡œ ì‚°ë‹¤", type: "chameleon" },
                        { text: "ê°€ì„±ë¹„ì™€ ì‹¤ìš©ì„±ì„ ë”°ì ¸ë³´ë©° ì‹ ì¤‘í•˜ê²Œ ê³ ë¥¸ë‹¤", type: "owl" },
                        { text: "ì¹œêµ¬ë‚˜ ê°€ì¡±ê³¼ í•¨ê»˜ ê°€ì„œ ì˜ê²¬ì„ ë“£ê³  ì‚°ë‹¤", type: "penguin" },
                        { text: "ì¢‹ì€ ì œí’ˆì„ ë°œê²¬í•˜ë©´ ì£¼ë³€ ì‚¬ëŒë“¤ì—ê²Œ ì¶”ì²œí•œë‹¤", type: "parrot" }
                    ]
                },
                {
                    question: "ì˜í™”ë‚˜ ì±…, ì½˜í…ì¸ ë¥¼ ì„ íƒí•  ë•Œ?",
                    answers: [
                        { text: "í‰ì ì´ ë†’ê±°ë‚˜ ê²€ì¦ëœ ì‘í’ˆì„ ì„ íƒí•œë‹¤", type: "ant" },
                        { text: "ë…íŠ¹í•˜ê±°ë‚˜ ì‹¤í—˜ì ì¸ ìƒˆë¡œìš´ ì‘í’ˆì„ ì°¾ëŠ”ë‹¤", type: "chameleon" },
                        { text: "ì¤„ê±°ë¦¬ì™€ ë¦¬ë·°ë¥¼ ê¼¼ê¼¼íˆ ì½ì–´ë³´ê³  ê²°ì •í•œë‹¤", type: "owl" },
                        { text: "ì¹œêµ¬ë“¤ì´ ì¶”ì²œí•˜ê±°ë‚˜ í•¨ê»˜ ë³¼ ìˆ˜ ìˆëŠ” ê±¸ ê³ ë¥¸ë‹¤", type: "penguin" },
                        { text: "ë³¸ í›„ì— ë‹¤ë¥¸ ì‚¬ëŒë“¤ì—ê²Œ í›„ê¸°ë¥¼ ì—´ì‹¬íˆ ì•Œë ¤ì¤€ë‹¤", type: "parrot" }
                    ]
                },
                {
                    question: "ì•½ì† ì‹œê°„ì— ëŒ€í•œ ë‚˜ì˜ íƒœë„ëŠ”?",
                    answers: [
                        { text: "í•­ìƒ 10ë¶„ ì „ì— ë„ì°©í•˜ë ¤ê³  ë…¸ë ¥í•œë‹¤", type: "ant" },
                        { text: "ì•½ì† ì‹œê°„ì´ ë”±ë”±í•˜ì§€ ì•Šì€ ê²Œ í¸í•˜ë‹¤", type: "chameleon" },
                        { text: "êµí†µìƒí™© ë“±ì„ ê³ ë ¤í•´ ì—¬ìœ ë¡­ê²Œ ì¶œë°œí•œë‹¤", type: "owl" },
                        { text: "í•¨ê»˜ ê°€ëŠ” ì‚¬ëŒì—ê²Œ ë§ì¶°ì„œ ì›€ì§ì¸ë‹¤", type: "penguin" },
                        { text: "ëŠ¦ì„ ê²ƒ ê°™ìœ¼ë©´ ë¯¸ë¦¬ë¯¸ë¦¬ ìƒí™©ì„ ê³µìœ í•œë‹¤", type: "parrot" }
                    ]
                },
                {
                    question: "ëª¨ì„ì´ë‚˜ íŒŒí‹°ì—ì„œ ë‚˜ì˜ ì—­í• ì€?",
                    answers: [
                        { text: "ì¤€ë¹„ë‚˜ ë’·ì •ë¦¬ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ë§¡ì•„ì„œ í•œë‹¤", type: "ant" },
                        { text: "ì¬ë¯¸ìˆëŠ” ì•„ì´ë””ì–´ë‚˜ ê²Œì„ì„ ì œì•ˆí•œë‹¤", type: "chameleon" },
                        { text: "í•œë°œ ë¬¼ëŸ¬ë‚˜ì„œ ë¶„ìœ„ê¸°ë¥¼ ê´€ì°°í•œë‹¤", type: "owl" },
                        { text: "ì‚¬ëŒë“¤ ì‚¬ì´ë¥¼ ì—°ê²°í•˜ê³  ëŒ€í™”ë¥¼ ì´ì–´ê°„ë‹¤", type: "penguin" },
                        { text: "ìµœê·¼ì— ì•Œê²Œ ëœ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì¤€ë‹¤", type: "parrot" }
                    ]
                },
                {
                    question: "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ê±°ë‚˜ í˜ë“¤ ë•Œ ë‚˜ëŠ”?",
                    answers: [
                        { text: "í•  ì¼ì„ í•˜ë‚˜ì”© ì²˜ë¦¬í•˜ë©´ì„œ ê·¹ë³µí•œë‹¤", type: "ant" },
                        { text: "í‰ì†Œì™€ ì „í˜€ ë‹¤ë¥¸ ì¼ì„ í•˜ë©° ê¸°ë¶„ì „í™˜í•œë‹¤", type: "chameleon" },
                        { text: "í˜¼ìë§Œì˜ ì‹œê°„ì„ ê°€ì§€ë©° ìƒê°ì„ ì •ë¦¬í•œë‹¤", type: "owl" },
                        { text: "ì¹œí•œ ì‚¬ëŒë“¤ì„ ë§Œë‚˜ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆˆë‹¤", type: "penguin" },
                        { text: "ë¹„ìŠ·í•œ ê²½í—˜ì„ í•œ ì‚¬ëŒë“¤ì˜ ì´ì•¼ê¸°ë¥¼ ì°¾ì•„ë³¸ë‹¤", type: "parrot" }
                    ]
                }
            ];

            // ê° ë™ë¬¼ ìœ í˜•ì— ëŒ€í•œ ê²°ê³¼ ì„¤ëª…
            // ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ: ê°™ì€ í´ë”ì— ìˆëŠ” ì´ë¯¸ì§€ íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤
            const results = {
                ant: {
                    emoji: "ğŸœ",
                    image: "https://hanuipyo.github.io/animal_mbti/ì¼ê°œë¯¸.png",  // ì¼ê°œë¯¸ ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ
                    title: "ì¼ê°œë¯¸í˜•",
                    subtitle: "ì ì‹œë„ ì‰¬ì§€ ëª»í•˜ëŠ”",
                    description: `
                        <h3>âœ¨ ë‹¹ì‹ ì€ ì¼ê°œë¯¸í˜•ì…ë‹ˆë‹¤!</h3>
                        <p><strong>íŠ¹ì§•:</strong> ì„±ì‹¤í•¨ê³¼ ê·¼ë©´í•¨ì´ ëª¸ì— ë°´ ë‹¹ì‹ ! ê³„íšì ì´ê³  ê¾¸ì¤€í•˜ê²Œ ìì‹ ì˜ ëª©í‘œë¥¼ í–¥í•´ ë‚˜ì•„ê°€ëŠ” ë…¸ë ¥íŒŒì…ë‹ˆë‹¤.</p>
                        <p><strong>ì¥ì :</strong> ì±…ì„ê°ì´ ê°•í•˜ê³  ë§¡ì€ ì¼ì€ ë°˜ë“œì‹œ ì™„ìˆ˜í•©ë‹ˆë‹¤. ì„±ì‹¤í•œ ëª¨ìŠµìœ¼ë¡œ ì£¼ë³€ ì‚¬ëŒë“¤ì—ê²Œ ì‹ ë¢°ë¥¼ ì–»ìŠµë‹ˆë‹¤.</p>
                        <p><strong>ì£¼ì˜ì‚¬í•­:</strong> ë•Œë¡œëŠ” íœ´ì‹ë„ í•„ìš”í•´ìš”! ë²ˆì•„ì›ƒì„ ì¡°ì‹¬í•˜ê³  ìì‹ ì„ ëŒë³´ëŠ” ì‹œê°„ë„ ê°€ì§€ì„¸ìš”.</p>
                        <p><strong>ì¶”ì²œ:</strong> ì™„ë²½í•¨ë³´ë‹¤ëŠ” ì™„ì„±ì„ ëª©í‘œë¡œ, ê°€ë”ì€ ì—¬ìœ ë¥¼ ê°€ì ¸ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?</p>
                    `
                },
                chameleon: {
                    emoji: "ğŸ¦",
                    image: "https://hanuipyo.github.io/animal_mbti/ì¹´ë©œë ˆì˜¨.png",  // ì¹´ë©œë ˆì˜¨ ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ
                    title: "ì¹´ë©œë ˆì˜¨í˜•",
                    subtitle: "ë§¤ì¼ ë‹¤ë¥¸ ê¿ˆì„ ê¾¸ëŠ”",
                    description: `
                        <h3>âœ¨ ë‹¹ì‹ ì€ ì¹´ë©œë ˆì˜¨í˜•ì…ë‹ˆë‹¤!</h3>
                        <p><strong>íŠ¹ì§•:</strong> ì°½ì˜ì ì´ê³  ìœ ì—°í•œ ì‚¬ê³ ì˜ ì†Œìœ ì! ëŠ˜ ìƒˆë¡œìš´ ê²ƒì„ ì‹œë„í•˜ê³  ë³€í™”ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ì•ŠëŠ” í˜ì‹ ê°€ì…ë‹ˆë‹¤.</p>
                        <p><strong>ì¥ì :</strong> ë‹¤ì–‘í•œ ì‹œë„ë¥¼ í•˜ë©° ìƒˆë¡œìš´ ê°€ëŠ¥ì„±ì„ ë°œê²¬í•©ë‹ˆë‹¤. í‹€ì— ë°•íˆì§€ ì•Šì€ ì‚¬ê³ ë¡œ ì‹ ì„ í•œ í•´ê²°ì±…ì„ ì œì‹œí•©ë‹ˆë‹¤.</p>
                        <p><strong>ì£¼ì˜ì‚¬í•­:</strong> ë„ˆë¬´ ë§ì€ ë³€í™”ëŠ” ì£¼ë³€ì„ í˜¼ë€ìŠ¤ëŸ½ê²Œ í•  ìˆ˜ë„ ìˆì–´ìš”. ë•Œë¡œëŠ” ì¼ê´€ì„±ë„ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        <p><strong>ì¶”ì²œ:</strong> ì°½ì˜ì„±ê³¼ ì•ˆì •ì„±ì˜ ê· í˜•ì„ ì°¾ì•„ë³´ì„¸ìš”. ìƒˆë¡œìš´ ì‹œë„ì— ì²´ê³„ë¥¼ ë”í•œë‹¤ë©´ ì™„ë²½í•©ë‹ˆë‹¤!</p>
                    `
                },
                owl: {
                    emoji: "ğŸ¦‰",
                    image: "https://hanuipyo.github.io/animal_mbti/ë¶€ì—‰ì´.png",  // ë¶€ì—‰ì´ ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ
                    title: "ë¶€ì—‰ì´í˜•",
                    subtitle: "í•­ìƒ ê³°ê³°íˆ ê³ ë¯¼í•´ë³´ëŠ”",
                    description: `
                        <h3>âœ¨ ë‹¹ì‹ ì€ ë¶€ì—‰ì´í˜•ì…ë‹ˆë‹¤!</h3>
                        <p><strong>íŠ¹ì§•:</strong> ì‹ ì¤‘í•˜ê³  ë¶„ì„ì ì¸ ì‚¬ê³ ì˜ ë‹¬ì¸! ê¹Šì´ ìˆëŠ” í†µì°°ë ¥ìœ¼ë¡œ ì‚¬ëŒê³¼ ìƒí™©ì„ ì´í•´í•˜ëŠ” ì§€í˜œë¡œìš´ ì‚¬ëŒì…ë‹ˆë‹¤.</p>
                        <p><strong>ì¥ì :</strong> ë¬¸ì œì˜ ë³¸ì§ˆì„ íŒŒì•…í•˜ëŠ” ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ê³ , ê¹Šì´ ìˆëŠ” ëŒ€í™”ì™€ ì´í•´ë¥¼ ì¤‘ìš”ì‹œí•©ë‹ˆë‹¤.</p>
                        <p><strong>ì£¼ì˜ì‚¬í•­:</strong> ë„ˆë¬´ ì˜¤ë˜ ê³ ë¯¼í•˜ë‹¤ ë³´ë©´ ê¸°íšŒë¥¼ ë†“ì¹  ìˆ˜ ìˆì–´ìš”. ë•Œë¡œëŠ” ì§ê´€ë„ ë¯¿ì–´ë³´ì„¸ìš”.</p>
                        <p><strong>ì¶”ì²œ:</strong> ë‹¹ì‹ ì˜ í†µì°°ë ¥ì„ ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ë‚˜ëˆ„ë©´ ë” í° ì‹œë„ˆì§€ê°€ ë‚  ê±°ì˜ˆìš”!</p>
                    `
                },
                penguin: {
                    emoji: "ğŸ§",
                    image: "https://hanuipyo.github.io/animal_mbti/í™©ì œí­ê·„.png",  // í™©ì œí­ê·„ ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ
                    title: "í™©ì œí­ê·„í˜•",
                    subtitle: "í˜¼ìì„  ëª»ì‚¬ëŠ”",
                    description: `
                        <h3>âœ¨ ë‹¹ì‹ ì€ í™©ì œí­ê·„í˜•ì…ë‹ˆë‹¤!</h3>
                        <p><strong>íŠ¹ì§•:</strong> í˜‘ë ¥ê³¼ ì†Œí†µì˜ ë‹¬ì¸! í•¨ê»˜í•˜ëŠ” ê²ƒì„ ì¦ê¸°ê³  ê´€ê³„ë¥¼ ì¤‘ì‹œí•˜ëŠ” ì‚¬êµì ì¸ ì‚¬ëŒì…ë‹ˆë‹¤.</p>
                        <p><strong>ì¥ì :</strong> ì‚¬ëŒë“¤ê³¼ì˜ í˜‘ë ¥ì„ í†µí•´ ë” ë‚˜ì€ ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤. ì£¼ë³€ ì‚¬ëŒë“¤ì„ ì—°ê²°í•˜ê³  í™”í•©ì„ ì´ëŒì–´ëƒ…ë‹ˆë‹¤.</p>
                        <p><strong>ì£¼ì˜ì‚¬í•­:</strong> ë•Œë¡œëŠ” í˜¼ì ê²°ì •í•˜ê³  ì‹¤í–‰í•´ì•¼ í•  ë•Œë„ ìˆì–´ìš”. ë…ë¦½ì„±ë„ í•¨ê»˜ í‚¤ì›Œë³´ì„¸ìš”.</p>
                        <p><strong>ì¶”ì²œ:</strong> ë‹¹ì‹ ì˜ ì†Œí†µ ëŠ¥ë ¥ì€ í° ê°•ì ì´ì—ìš”. ëª¨ì„ì˜ ë¶„ìœ„ê¸° ë©”ì´ì»¤ë¡œ í™œì•½í•´ë³´ì„¸ìš”!</p>
                    `
                },
                parrot: {
                    emoji: "ğŸ¦œ",
                    image: "https://hanuipyo.github.io/animal_mbti/ì•µë¬´ìƒˆ.png",  // ì•µë¬´ìƒˆ ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ
                    title: "ì•µë¬´ìƒˆí˜•",
                    subtitle: "í•­ìƒ ì•Œë ¤ì£¼ê³  ì‹¶ì€",
                    description: `
                        <h3>âœ¨ ë‹¹ì‹ ì€ ì•µë¬´ìƒˆí˜•ì…ë‹ˆë‹¤!</h3>
                        <p><strong>íŠ¹ì§•:</strong> ì§€ì‹ ê³µìœ ì˜ ì—´ì •ê°€! ë°°ìš´ ê²ƒì„ ë‚˜ëˆ„ëŠ” ê²ƒì„ ì¢‹ì•„í•˜ê³  ì†Œí†µì„ ì¤‘ì‹œí•˜ëŠ” ì¹œì ˆí•œ ì‚¬ëŒì…ë‹ˆë‹¤.</p>
                        <p><strong>ì¥ì :</strong> ì •ë³´ë¥¼ ì‰½ê³  ëª…í™•í•˜ê²Œ ì „ë‹¬í•˜ëŠ” ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤. ìœ ìš©í•œ ì •ë³´ ê³µìœ ë¡œ ì£¼ë³€ ì‚¬ëŒë“¤ì„ ë•ìŠµë‹ˆë‹¤.</p>
                        <p><strong>ì£¼ì˜ì‚¬í•­:</strong> ë•Œë¡œëŠ” ë“£ëŠ” ê²ƒë„ ì¤‘ìš”í•´ìš”. ì¼ë°©ì ì¸ ì „ë‹¬ë³´ë‹¤ëŠ” ìŒë°©í–¥ ì†Œí†µì„ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                        <p><strong>ì¶”ì²œ:</strong> ë‹¹ì‹ ì˜ ì „ë‹¬ë ¥ì€ í›Œë¥­í•´ìš”! ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ì´ì•¼ê¸°ë„ ê·€ ê¸°ìš¸ì—¬ ë“¤ì–´ì£¼ë©´ ë”ìš± ì™„ë²½í•©ë‹ˆë‹¤.</p>
                    `
                }
            };

            // í€´ì¦ˆë¥¼ ì‹œì‘í•˜ëŠ” í•¨ìˆ˜
            function startQuiz() {
                // ì‹œì‘ í™”ë©´ì„ ìˆ¨ê¸°ê³  í€´ì¦ˆ í™”ë©´ì„ ë³´ì—¬ì¤ë‹ˆë‹¤
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('quizScreen').style.display = 'block';
                showQuestion(); // ì²« ë²ˆì§¸ ì§ˆë¬¸ì„ ë³´ì—¬ì¤ë‹ˆë‹¤
            }

            // í˜„ì¬ ì§ˆë¬¸ì„ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
            function showQuestion() {
                const question = questions[currentQuestion]; // í˜„ì¬ ì§ˆë¬¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤
                
                // ì§„í–‰ë¥  ë°”ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤
                const progress = ((currentQuestion + 1) / questions.length) * 100;
                document.getElementById('progress').style.width = progress + '%';
                
                // ì§ˆë¬¸ ë²ˆí˜¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
                document.getElementById('questionNumber').textContent = 
                    `ì§ˆë¬¸ ${currentQuestion + 1} / ${questions.length}`;
                
                // ì§ˆë¬¸ ë‚´ìš©ì„ í‘œì‹œí•©ë‹ˆë‹¤
                document.getElementById('question').textContent = question.question;
                
                // ë‹µë³€ ì„ íƒì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                const answersDiv = document.getElementById('answers');
                answersDiv.innerHTML = ''; // ê¸°ì¡´ ë‹µë³€ì„ ì§€ì›ë‹ˆë‹¤
                
                // ê° ë‹µë³€ ë²„íŠ¼ì„ ë§Œë“¤ì–´ì„œ ì¶”ê°€í•©ë‹ˆë‹¤
                question.answers.forEach((answer, index) => {
                    const button = document.createElement('button');
                    button.className = 'answer-btn';
                    button.textContent = answer.text;
                    // ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ selectAnswer í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤
                    button.onclick = () => selectAnswer(answer.type);
                    answersDiv.appendChild(button);
                });
            }

            // ë‹µë³€ì„ ì„ íƒí–ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
            function selectAnswer(type) {
                // ì„ íƒí•œ ë™ë¬¼ ìœ í˜•ì˜ ì ìˆ˜ë¥¼ 1ì  ì¦ê°€ì‹œí‚µë‹ˆë‹¤
                scores[type]++;
                
                // ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤
                currentQuestion++;
                
                // ëª¨ë“  ì§ˆë¬¸ì„ ë‹¤ ë‹µí–ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤
                if (currentQuestion < questions.length) {
                    // ì•„ì§ ì§ˆë¬¸ì´ ë‚¨ì•„ìˆìœ¼ë©´ ë‹¤ìŒ ì§ˆë¬¸ì„ ë³´ì—¬ì¤ë‹ˆë‹¤
                    showQuestion();
                } else {
                    // ëª¨ë“  ì§ˆë¬¸ì„ ë‹µí–ˆìœ¼ë©´ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤
                    showResult();
                }
            }

            // ê²°ê³¼ë¥¼ ê³„ì‚°í•˜ê³  í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ (ë¹„ë™ê¸°)
            async function showResult() {
                // í€´ì¦ˆ í™”ë©´ì„ ìˆ¨ê¸°ê³  ê²°ê³¼ í™”ë©´ì„ ë³´ì—¬ì¤ë‹ˆë‹¤
                document.getElementById('quizScreen').style.display = 'none';
                document.getElementById('resultScreen').style.display = 'block';
                
                // ë¡œë”© í‘œì‹œ
                document.getElementById('resultType').textContent = 'ê²°ê³¼ ê³„ì‚° ì¤‘...';
                
                // ê°€ì¥ ë†’ì€ ì ìˆ˜ë¥¼ ë°›ì€ ë™ë¬¼ ìœ í˜•ì„ ì°¾ìŠµë‹ˆë‹¤
                let maxScore = 0;
                let originalResultType = '';
                
                // ëª¨ë“  ë™ë¬¼ ìœ í˜•ì˜ ì ìˆ˜ë¥¼ í™•ì¸í•©ë‹ˆë‹¤
                for (let type in scores) {
                    if (scores[type] > maxScore) {
                        maxScore = scores[type];
                        originalResultType = type;
                    }
                }
                
                // ê· ë“± ë°°ì • ë¡œì§ ì ìš©: í†µê³„ë¥¼ ê³ ë ¤í•˜ì—¬ ê²°ê³¼ ìœ í˜• ì¡°ì •
                const finalResultType = await adjustForBalance(originalResultType);
                
                // í†µê³„ í™•ì¸ ë° ì €ì¥
                const stats = await loadStatistics();
                const total = stats.total || (stats.ant + stats.chameleon + stats.owl + stats.penguin + stats.parrot);
                
                // ìµœëŒ€ ì¸ì›ìˆ˜ì— ë„ë‹¬í•˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ í†µê³„ ì—…ë°ì´íŠ¸
                if (total < MAX_PARTICIPANTS) {
                    await saveResultToSheets(finalResultType, originalResultType);
                }
                
                // ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤
                const result = results[finalResultType];
                // ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ë¬¼ì„ í‘œì‹œí•©ë‹ˆë‹¤ (ì´ëª¨ì§€ ëŒ€ì‹ )
                const resultAnimalDiv = document.getElementById('resultAnimal');
                resultAnimalDiv.innerHTML = `<img src="${result.image}" alt="${result.title}">`;
                document.getElementById('resultType').textContent = result.title;
                
                // ì›ë˜ ê²°ê³¼ì™€ ì¡°ì •ëœ ê²°ê³¼ê°€ ë‹¤ë¥¼ ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€
                let description = result.description;
                if (originalResultType !== finalResultType) {
                    const originalResult = results[originalResultType];
                    description += `<p style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 8px; color: #856404; font-size: 0.9em;">
                        <strong>ğŸ’¡ ì°¸ê³ :</strong> ê· ë“± ë°°ì •ì„ ìœ„í•´ <strong>${originalResult.title}</strong>ì—ì„œ <strong>${result.title}</strong>ë¡œ ì¡°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </p>`;
                }
                
                document.getElementById('resultDescription').innerHTML = description;
            }

            // í…ŒìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ëŠ” í•¨ìˆ˜
            function restartQuiz() {
                // ëª¨ë“  ë³€ìˆ˜ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤
                currentQuestion = 0;
                scores = {
                    ant: 0,
                    chameleon: 0,
                    owl: 0,
                    penguin: 0,
                    parrot: 0
                };
                
                // ì‚¬ìš©ì ì •ë³´ë„ ì´ˆê¸°í™” (ë§¤ë²ˆ ìƒˆë¡œ ì…ë ¥ë°›ê¸° ìœ„í•´)
                userInfo.school = '';
                userInfo.name = '';
                userInfo.email = '';
                
                // ê²°ê³¼ í™”ë©´ì„ ìˆ¨ê¸°ê³  ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í™”ë©´ì„ ë³´ì—¬ì¤ë‹ˆë‹¤
                document.getElementById('resultScreen').style.display = 'none';
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('quizScreen').style.display = 'none';
                showUserInfoScreen();
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('userSchool').value = '';
                document.getElementById('userName').value = '';
                document.getElementById('userEmail').value = '';
                document.getElementById('schoolError').style.display = 'none';
                document.getElementById('nameError').style.display = 'none';
                document.getElementById('emailError').style.display = 'none';
                document.getElementById('userInfoError').style.display = 'none';
            }

            // ì‚¬ìš©ì ì •ë³´ ì €ì¥ í•¨ìˆ˜
            function saveUserInfo() {
                const school = document.getElementById('userSchool').value.trim();
                const name = document.getElementById('userName').value.trim();
                const email = document.getElementById('userEmail').value.trim();
                
                // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
                document.getElementById('schoolError').style.display = 'none';
                document.getElementById('nameError').style.display = 'none';
                document.getElementById('emailError').style.display = 'none';
                document.getElementById('userInfoError').style.display = 'none';
                
                let hasError = false;
                
                // ì†Œì† ê²€ì¦
                if (!school) {
                    document.getElementById('schoolError').textContent = 'ì†Œì† ê¸°ê´€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    document.getElementById('schoolError').style.display = 'block';
                    hasError = true;
                } else if (school.length < 2) {
                    document.getElementById('schoolError').textContent = 'ì†Œì† ê¸°ê´€ëª…ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤.';
                    document.getElementById('schoolError').style.display = 'block';
                    hasError = true;
                }
                
                // ì´ë¦„ ê²€ì¦
                if (!name) {
                    document.getElementById('nameError').textContent = 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    document.getElementById('nameError').style.display = 'block';
                    hasError = true;
                } else if (name.length < 2) {
                    document.getElementById('nameError').textContent = 'ì„±ê³¼ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    document.getElementById('nameError').style.display = 'block';
                    hasError = true;
                }
                
                // ì´ë©”ì¼ ê²€ì¦
                if (!email) {
                    document.getElementById('emailError').textContent = 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    document.getElementById('emailError').style.display = 'block';
                    hasError = true;
                } else {
                    // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦ (ê°„ë‹¨í•œ ì •ê·œì‹)
                    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailPattern.test(email)) {
                        document.getElementById('emailError').textContent = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                        document.getElementById('emailError').style.display = 'block';
                        hasError = true;
                    }
                }
                
                if (hasError) {
                    return;
                }
                
                // ì‚¬ìš©ì ì •ë³´ ì €ì¥
                userInfo.school = school;
                userInfo.name = name;
                userInfo.email = email;
                
                // localStorageì— ì €ì¥í•˜ì§€ ì•ŠìŒ (ë§¤ë²ˆ ì…ë ¥ë°›ê¸° ìœ„í•´)
                // í•„ìš”ì‹œ ì£¼ì„ì„ í•´ì œí•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                // try {
                //     localStorage.setItem('userSchool', school);
                //     localStorage.setItem('userName', name);
                // } catch (e) {
                //     console.warn('ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì‹¤íŒ¨:', e);
                // }
                
                // ì‹œì‘ í™”ë©´ìœ¼ë¡œ ì´ë™
                document.getElementById('userInfoScreen').style.display = 'none';
                document.getElementById('startScreen').style.display = 'block';
            }

            // ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í™”ë©´ í‘œì‹œ í•¨ìˆ˜
            function showUserInfoScreen() {
                document.getElementById('userInfoScreen').style.display = 'block';
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('quizScreen').style.display = 'none';
                document.getElementById('resultScreen').style.display = 'none';
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
            window.addEventListener('DOMContentLoaded', function() {
                // í•­ìƒ ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í™”ë©´ì„ ë¨¼ì € ë³´ì—¬ì¤ë‹ˆë‹¤
                // localStorageì— ì €ì¥ëœ ì •ë³´ê°€ ìˆì–´ë„ ë§¤ë²ˆ ì…ë ¥ë°›ë„ë¡ í•©ë‹ˆë‹¤
                showUserInfoScreen();
                
                // ë‹¤ë¥¸ í™”ë©´ë“¤ì€ ìˆ¨ê¹ë‹ˆë‹¤
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('quizScreen').style.display = 'none';
                document.getElementById('resultScreen').style.display = 'none';
            });
        </script>
    </body>
    </html>
